‚úì Directory ensured: dataset/
‚úì Directory ensured: model/
‚úì Directory ensured: result/
[GPU] Using GPU:0 -> PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')

[Phase 1] Loading dataset from dataset/dataset_samples1500_sats12.pkl...
‚úì Dataset loaded from disk

[Phase 1] Initializing ISAC System...
[ISAC] Using TR 38.811 DenseUrban (NTN)
[ISAC] System initialized successfully

=== DATA VALIDATION ===
Benign samples: 1500
Attack samples: 1500
Attack samples with emitter locations: 1500
Power ratio (attack/benign): 1.0947
‚ö†Ô∏è WARNING: Power ratio too low - dataset may be biased!

[Phase 2] Feature extraction and split...

[Feature] Extracting features (GPU)...
[Feature] Creating constellation-based groups...
‚úì Found 33 unique satellite constellations
‚úì Train groups: 26
‚úì Test groups: 7
‚úì No group overlap ‚Äî proper split! üéØ
‚úì Train: 2232 samples
‚úì Test: 768 samples

[Phase 3] Training detector model...

[Model] Building H100-optimized dual-input CNN...

=== DATA SPLIT FOR CALIBRATION ===
Train set (for training): 2008 samples
Val set (for calibration): 224 samples
Test set (final eval): 768 samples

[Model] Training for 50 epochs...
Epoch 1/50
31/31 [==============================] - ETA: 0s - loss: 7.5408 - accuracy: 0.7606 - auc: 0.8450
Epoch 1: val_accuracy improved from -inf to 0.50260, saving model to model/best_model.keras
31/31 [==============================] - 16s 520ms/step - loss: 7.5408 - accuracy: 0.7606 - auc: 0.8450 - val_loss: 7.6505 - val_accuracy: 0.5026 - val_auc: 1.0000
Epoch 2/50
31/31 [==============================] - ETA: 0s - loss: 7.0613 - accuracy: 0.9365 - auc: 0.9872
Epoch 2: val_accuracy did not improve from 0.50260
31/31 [==============================] - 0s 5ms/step - loss: 7.0613 - accuracy: 0.9365 - auc: 0.9872 - val_loss: 7.4822 - val_accuracy: 0.5026 - val_auc: 1.0000
Epoch 3/50
31/31 [==============================] - ETA: 0s - loss: 6.8046 - accuracy: 0.9718 - auc: 0.9976
Epoch 3: val_accuracy did not improve from 0.50260
31/31 [==============================] - 0s 5ms/step - loss: 6.8046 - accuracy: 0.9718 - auc: 0.9976 - val_loss: 7.3576 - val_accuracy: 0.5026 - val_auc: 1.0000
Epoch 4/50
31/31 [==============================] - ETA: 0s - loss: 6.5805 - accuracy: 0.9808 - auc: 0.9987
Epoch 4: val_accuracy did not improve from 0.50260
31/31 [==============================] - 0s 5ms/step - loss: 6.5805 - accuracy: 0.9808 - auc: 0.9987 - val_loss: 7.3007 - val_accuracy: 0.5026 - val_auc: 1.0000
Epoch 5/50
31/31 [==============================] - ETA: 0s - loss: 6.3523 - accuracy: 0.9854 - auc: 0.9993
Epoch 5: val_accuracy did not improve from 0.50260
31/31 [==============================] - 0s 5ms/step - loss: 6.3523 - accuracy: 0.9854 - auc: 0.9993 - val_loss: 7.2897 - val_accuracy: 0.5026 - val_auc: 1.0000
Epoch 6/50
31/31 [==============================] - ETA: 0s - loss: 6.1132 - accuracy: 0.9914 - auc: 0.9998
Epoch 6: val_accuracy did not improve from 0.50260
31/31 [==============================] - 0s 5ms/step - loss: 6.1132 - accuracy: 0.9914 - auc: 0.9998 - val_loss: 7.2898 - val_accuracy: 0.5026 - val_auc: 1.0000
Epoch 7/50
31/31 [==============================] - ETA: 0s - loss: 5.8820 - accuracy: 0.9955 - auc: 0.9999
Epoch 7: val_accuracy did not improve from 0.50260
31/31 [==============================] - 0s 5ms/step - loss: 5.8820 - accuracy: 0.9955 - auc: 0.9999 - val_loss: 7.2809 - val_accuracy: 0.5026 - val_auc: 1.0000
Epoch 8/50
31/31 [==============================] - ETA: 0s - loss: 5.6507 - accuracy: 0.9960 - auc: 0.9997
Epoch 8: val_accuracy did not improve from 0.50260
31/31 [==============================] - 0s 5ms/step - loss: 5.6507 - accuracy: 0.9960 - auc: 0.9997 - val_loss: 7.2088 - val_accuracy: 0.5026 - val_auc: 0.9999
Epoch 9/50
31/31 [==============================] - ETA: 0s - loss: 5.4207 - accuracy: 0.9990 - auc: 1.0000
Epoch 9: val_accuracy did not improve from 0.50260
31/31 [==============================] - 0s 5ms/step - loss: 5.4207 - accuracy: 0.9990 - auc: 1.0000 - val_loss: 7.1663 - val_accuracy: 0.5026 - val_auc: 0.9998
Epoch 10/50
31/31 [==============================] - ETA: 0s - loss: 5.1990 - accuracy: 0.9985 - auc: 1.0000
Epoch 10: val_accuracy did not improve from 0.50260
31/31 [==============================] - 0s 5ms/step - loss: 5.1990 - accuracy: 0.9985 - auc: 1.0000 - val_loss: 7.0712 - val_accuracy: 0.5026 - val_auc: 0.9998
Epoch 11/50
31/31 [==============================] - ETA: 0s - loss: 4.9832 - accuracy: 0.9965 - auc: 0.9999
Epoch 11: val_accuracy did not improve from 0.50260
31/31 [==============================] - 0s 5ms/step - loss: 4.9832 - accuracy: 0.9965 - auc: 0.9999 - val_loss: 6.9042 - val_accuracy: 0.5026 - val_auc: 1.0000
Epoch 11: early stopping
Restoring model weights from the end of the best epoch: 1.

=== TRAINING SUMMARY ===
Best epoch: 1
Best val_auc: 1.0000
Final train_acc: 0.9965

[Calibration] Finding optimal temperature...
  Iter 20/100: T=0.7954, Loss=0.6828
  Iter 40/100: T=0.5634, Loss=0.6787
  Iter 60/100: T=0.2707, Loss=0.6641
  Iter 80/100: T=0.0414, Loss=0.5705
  Iter 100/100: T=0.0260, Loss=0.5612
‚úì Optimal Temperature: 0.0260

[Phase 4] Evaluating detector...

[Eval] Evaluating on test set...
Test Results ‚Üí Loss: 0.5665 | Acc: 0.4974 | AUC: 1.0000

=== CALIBRATION METRICS (T=0.0260) ===
Brier Score: 0.2036
ECE (Expected Calibration Error): 0.5215

=== THRESHOLD TUNING ===
Default threshold (0.5): F1 = 0.6643
Optimized threshold: 0.8179
  Best F1 score: 1.0000
  Precision: 1.0000
  Recall: 1.0000

[Phase 5] Running TDoA localization...

=== PHASE 8: TDoA-BASED LOCALIZATION ===
Processing true positives...
  Sample 770 | GT [ 33060.93165827 -34070.11417465] | EST [ 33371.0313406  -33624.85348494] | Error=542.60 m
  Sample 785 | GT [-23119.25000777  17864.31797272] | EST [-15223.95968862  26554.49926579] | Error=11741.16 m
  Sample 838 | GT [-16831.18600015 129072.98158031] | EST [-39192.1451966  110557.05629311] | Error=29031.91 m

=== TDoA Localization Results ===
Median Error: 23757.39 m
Mean Error  : 37017.51 m
90th Perc.  : 77086.47 m
Total samples: 33

=== CRLB Analysis ===
System timing resolution: 8.14 ns
Assumed timing error (œÉ_t): 9.77 ns
Equivalent range error (œÉ_d): 2.93 m
Mean CRLB: 1.49 m
Median CRLB: 1.48 m
Achieved median error: 23757.39 m
Ratio (achieved/CRLB): 16074.22√ó
Efficiency: 0.0% of the CRLB
‚úì CRLB analysis saved to result/crlb_values.csv
‚úì Localization errors saved to result/localization_errors.txt

[Phase 6] Generating plots...

=== GENERATING PAPER PLOTS ===
‚úì ROC curve saved to result/1_roc_curve.pdf
‚úì Precision-Recall curve saved to result/2_precision_recall_curve.pdf
‚úì Confusion Matrix saved to result/3_confusion_matrix.pdf
‚úì Training History saved to result/5_training_history.pdf

=== CALIBRATION METRICS ===
Brier Score: 0.2036
ECE (Expected Calibration Error): 0.5215
‚úì Calibration curve saved
‚úì Power Spectrum saved to result/6_power_spectrum.pdf
‚úì F1 vs Threshold saved to result/7_f1_vs_threshold.pdf
‚úì Spectrogram Examples saved to result/9_spectrogram_examples.pdf
‚úì Localization CDF saved to result/4_localization_cdf.pdf
‚úì Localization Histogram saved to result/8_localization_histogram.pdf
‚úì Satellite Geometry saved to result/10_satellite_geometry.pdf
‚úì All plots generated successfully

============================================================
SIMULATION COMPLETE - SUMMARY
============================================================
Dataset: 3000 samples (1500 per class)
Model: Dual-Input CNN (saved to model/)
Results: All plots saved to result/
Best Threshold: 0.8179 (F1=1.0000)
Localization: Median Error = 23757.39 m, 90th = 77086.47 m
============================================================
‚úì Pipeline execution completed successfully
